<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Scope trong Active Record sử dụng như thế nào cho đúng</title>
    <meta name="description" content="Đối với developer Rails thì việc sử dụng scope và class method khá quen thuộc, nhưng sử dụng nó như thế nào cho đúng thì ta cùng xem xét ví dụ bên dưới:# mod...">

    <link rel="shortcut icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_8v3czwksspqlg14i.css">
    <link rel="stylesheet" href="/css/main.css ">
    <link rel="canonical" href="http://localhost:4000/scope-trong-active-record-su-dung-nhu-the-nao-cho-dung">
    <link rel="alternate" type="application/rss+xml" title="Technical Tips" href="http://localhost:4000/feed.xml ">
    <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Technical Tips" />
    <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Scope trong Active Record sử dụng như thế nào cho đúng | Technical Tips</title>
<meta name="generator" content="Jekyll v3.7.4" />
<meta property="og:title" content="Scope trong Active Record sử dụng như thế nào cho đúng" />
<meta name="author" content="Minh Tang Q." />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Đối với developer Rails thì việc sử dụng scope và class method khá quen thuộc, nhưng sử dụng nó như thế nào cho đúng thì ta cùng xem xét ví dụ bên dưới: # model/company_contract.rb class CompanyContract &lt; ApplicationRecord # Ví dụ 1: scope :latest_contract, lambda { |company_id| where(company_id: company_id).order(:start_date).last } # Ví dụ 2: scope :latest_contract, lambda { |company_id| find_by(company_id: company_id).order(:start_date) } end" />
<meta property="og:description" content="Đối với developer Rails thì việc sử dụng scope và class method khá quen thuộc, nhưng sử dụng nó như thế nào cho đúng thì ta cùng xem xét ví dụ bên dưới: # model/company_contract.rb class CompanyContract &lt; ApplicationRecord # Ví dụ 1: scope :latest_contract, lambda { |company_id| where(company_id: company_id).order(:start_date).last } # Ví dụ 2: scope :latest_contract, lambda { |company_id| find_by(company_id: company_id).order(:start_date) } end" />
<link rel="canonical" href="http://localhost:4000/scope-trong-active-record-su-dung-nhu-the-nao-cho-dung" />
<meta property="og:url" content="http://localhost:4000/scope-trong-active-record-su-dung-nhu-the-nao-cho-dung" />
<meta property="og:site_name" content="Technical Tips" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-11-25T19:30:18+07:00" />
<script type="application/ld+json">
{"url":"http://localhost:4000/scope-trong-active-record-su-dung-nhu-the-nao-cho-dung","headline":"Scope trong Active Record sử dụng như thế nào cho đúng","dateModified":"2018-11-25T19:30:18+07:00","datePublished":"2018-11-25T19:30:18+07:00","author":{"@type":"Person","name":"Minh Tang Q."},"description":"Đối với developer Rails thì việc sử dụng scope và class method khá quen thuộc, nhưng sử dụng nó như thế nào cho đúng thì ta cùng xem xét ví dụ bên dưới: # model/company_contract.rb class CompanyContract &lt; ApplicationRecord # Ví dụ 1: scope :latest_contract, lambda { |company_id| where(company_id: company_id).order(:start_date).last } # Ví dụ 2: scope :latest_contract, lambda { |company_id| find_by(company_id: company_id).order(:start_date) } end","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/scope-trong-active-record-su-dung-nhu-the-nao-cho-dung"},"@type":"BlogPosting","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->






</head>


  <body>

    <header id="top">
    <div class="wrapper">
        <a href="/" class="brand">Technical Tips</a>
        <small>Chia sẽ kỹ thuật lập trình</small>
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                <li>
                    
                    <a href="/">
                    
                        <i class="fa fa-home"></i>Home
                    </a>
                </li>

                
                    
                    <li>
                        
                        <a href="/archive/">
                        
                            <i class="fa fa-archive"></i>Archives
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/collection/">
                        
                            <i class="fa fa-bookmark"></i>Collections
                        </a>
                    </li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
</header>


        <div class="page clearfix" post>
    <div class="left">
        <h1>Scope trong Active Record sử dụng như thế nào cho đúng</h1>
        <div class="label">

            <div class="label-card">
                <i class="fa fa-calendar"></i>2018-11-25
            </div>

            <div class="label-card">
                <i class="fa fa-user"></i>Minh Tang Q.
                
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
            


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#RubyOnRails" title="Category: RubyOnRails" rel="category">RubyOnRails</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


            </div>

            <div class="label-card">
            
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <!--a href="/tag/#Rails%2C" title="Tag: Rails," rel="tag">Rails,</a-->
        <a href="/tag/#Rails," title="Tag: Rails," rel="tag">Rails,</a>&nbsp;
    
        <!--a href="/tag/#Scope%2C" title="Tag: Scope," rel="tag">Scope,</a-->
        <a href="/tag/#Scope," title="Tag: Scope," rel="tag">Scope,</a>&nbsp;
    
        <!--a href="/tag/#ActiveRecord" title="Tag: ActiveRecord" rel="tag">ActiveRecord</a-->
        <a href="/tag/#ActiveRecord" title="Tag: ActiveRecord" rel="tag">ActiveRecord</a>
    
  

</span>

            </div>

        </div>
        <hr>
        <article itemscope itemtype="http://schema.org/BlogPosting">
        
<p>Đối với developer Rails thì việc sử dụng scope và class method khá quen thuộc, nhưng sử dụng nó như thế nào cho đúng thì ta cùng xem xét ví dụ bên dưới:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># model/company_contract.rb</span>
<span class="k">class</span> <span class="nc">CompanyContract</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
    <span class="c1"># Ví dụ 1:</span>
    <span class="n">scope</span> <span class="ss">:latest_contract</span><span class="p">,</span> <span class="nb">lambda</span> <span class="p">{</span> <span class="o">|</span><span class="n">company_id</span><span class="o">|</span>
        <span class="n">where</span><span class="p">(</span><span class="ss">company_id: </span><span class="n">company_id</span><span class="p">).</span><span class="nf">order</span><span class="p">(</span><span class="ss">:start_date</span><span class="p">).</span><span class="nf">last</span>
    <span class="p">}</span>

    <span class="c1"># Ví dụ 2:</span>
    <span class="n">scope</span> <span class="ss">:latest_contract</span><span class="p">,</span> <span class="nb">lambda</span> <span class="p">{</span> <span class="o">|</span><span class="n">company_id</span><span class="o">|</span>
        <span class="n">find_by</span><span class="p">(</span><span class="ss">company_id: </span><span class="n">company_id</span><span class="p">).</span><span class="nf">order</span><span class="p">(</span><span class="ss">:start_date</span><span class="p">)</span>
    <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Trong đoạn code trên ta sử dụng <code class="highlighter-rouge">scope</code> để chỉ lấy ra <strong>duy nhất một kết quả</strong> dựa vào đối số truyền vào. <strong>Nếu như tìm thấy dữ liệu</strong> thì kết quả đều cho ra như nhau. Nhưng điều đáng lưu ý là giả sử như nếu không có dữ liệu trả về thì điều gì xảy ra?</p>

<p>Bởi vì <code class="highlighter-rouge">scope</code> là một <code class="highlighter-rouge">Relation</code> cho nên nếu như tìm không ra dữ liệu thì kết quả sẽ trả ra tất cả các Record có trong bảng CompanyContract.</p>

<p>Cho nên từ giờ ta đúc kết ra một kinh nghiệm nếu như ta muốn <strong>tìm một kết quả</strong> thì ta nên sử dụng <code class="highlighter-rouge">class method</code>, còn ngược lại nếu đầu ra là 1 tập hợp các kết quả thì vẫn sử dụng scope như bình thường.
Trong ví dụ trên ta có thể viết class method như sau:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">lastest_contract</span><span class="p">(</span><span class="n">company_id</span><span class="p">)</span>
    <span class="n">find_by</span><span class="p">(</span><span class="ss">company_id: </span><span class="n">company_id</span><span class="p">).</span><span class="nf">order</span><span class="p">(</span><span class="ss">:start_date</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>
<p>Lưu ý: Nếu ta sử dụng class method cho việc truy vấn lấy ra nhiều kết quả thì ta sẽ không <code class="highlighter-rouge">chain</code> (nối) các method khác. Đây là điểm khác biệt cần lưu ý khi sử dụng class method và scope.</p>

        </article>
        <hr>

        
        
            
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
        

        <div class="post-recent">
    <div class="pre">
        
        <p><strong>上一篇</strong> <a href="/2018/10/10/vscode-plugin-schedule/">vscode 插件 markdown-schedule-snippet</a></p>
        
    </div>
    <div class="nex">

        
    </div>
</div>


        <h2 id="comments">Comments</h2>
        


<div id="disqus_thread"></div>
<script>
    /**
     * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */

    var disqus_config = function() {
        this.page.url = 'http://localhost:4000/scope-trong-active-record-su-dung-nhu-the-nao-cho-dung'; // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = 'http://localhost:4000/scope-trong-active-record-su-dung-nhu-the-nao-cho-dung'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };

    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document,
            s = d.createElement('script');

        s.src = '//vhquocminhit.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>




    </div>
    <button class="anchor"><i class="fa fa-anchor"></i></button>
    <div class="right">
        <div class="wrap">

            <!-- Content -->
            <div class="side content">
                <div>
                    Content
                </div>
                <ul id="content-side" class="content-ul">
                    
                    <li><a href="#comments">Comments</a></li>
                </ul>
            </div>
            <!-- 其他div框放到这里 -->
            <!-- <div class="side">bbbb</div> -->
        </div>
    </div>
</div>
<script>
/**
 * target _blank
 */
(function() {
    var aTags = document.querySelectorAll('article a:not([id])')
    for (var i = 0; i < aTags.length; i++) {
        aTags[i].setAttribute('target', '_blank')
    }
}());
</script>
<script src="/js/pageContent.js " charset="utf-8"></script>


    <footer class="site-footer">


    <div class="wrapper">

        <p class="description">
             Chia sẽ kỹ thuật lập trình 
        </p>
        <p class="contact">
            Contact me at: 
            <a href="https://github.com/rubykachu" title="GitHub"><i class="fa fa-github" aria-hidden="true"></i></a>  
            <a href="mailto:minh.tang@asiantech.vn" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a>    
            <a href="https://twitter.com/vhquocminhit" title="Twitter"><i class="fa fa-twitter" aria-hidden="true"></i></a>  
            <a href="https://www.facebook.com/tangquocminh" title="Facebook"><i class="fa fa-facebook-official" aria-hidden="true"></i></a>    
        </p>
        <p>
            本站总访问量<span id="busuanzi_value_site_pv"></span>次，本站访客数<span id="busuanzi_value_site_uv"></span>人次，本文总阅读量<span id="busuanzi_value_page_pv"></span>次
        </p>
        <p class="power">
            <span>
                Site powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://pages.github.com/">Github Pages</a>.
            </span>
            <span>
                Theme designed by <a href="https://github.com/Gaohaoyang">HyG</a>.
            </span>
        </p>
    </div>
</footer>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <div class="back-to-top">
    <a href="#top" data-scroll>
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

    <script src=" /js/main.js " charset="utf-8"></script>
    <script src=" /js/smooth-scroll.min.js " charset="utf-8"></script>
    <script type="text/javascript">
      smoothScroll.init({
        speed: 500, // Integer. How fast to complete the scroll in milliseconds
        easing: 'easeInOutCubic', // Easing pattern to use
        offset: 20, // Integer. How far to offset the scrolling anchor location in pixels
      });
    </script>
    <!-- <script src=" /js/scroll.min.js " charset="utf-8"></script> -->
  </body>

</html>
